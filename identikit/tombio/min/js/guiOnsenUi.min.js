!function(t,o){"use strict";t("#tombiod3-header").remove(),t("#tombiod3-footer").remove();var e,i={};function n(){t("#tombioOnsVisDisplay").width()<208?(t("#tombioOnsToolsRight").hide(),t("#tombioOnsToolsLeft").show()):(t("#tombioOnsToolsRight").show(),t("#tombioOnsToolsLeft").hide())}function s(){var i,n=o.v.visualisations[o.v.currentTool];i=n&&n.inputControl?n.inputControl.width:n&&n.taxonSelect?n.taxonSelect.width:230,t("#tombioOnsMenu").css("width",i),e?(o.v.includedVisualisations.indexOf(o.v.currentTool)>-1?(t("ons-splitter-content").css("left",i),t("ons-splitter-side").show()):(t("ons-splitter-content").css("left","0px"),t("ons-splitter-side").hide()),t("#tombioUiSideMenuBackButton").hide(),t("#tombioUiSideMenuPinIcon").attr("icon","md-pin")):(t("#tombioUiSideMenuBackButton").show(),t("#tombioUiSideMenuPinIcon").attr("icon","md-pin-off")),o.v.includedVisualisations.indexOf(o.v.currentTool)>-1?e?t("#tombioUiInputToolbarButton").hide():t("#tombioUiInputToolbarButton").show():t("#tombioUiInputToolbarButton").hide()}o.gui.main={fn:{}},o.gui.main.setSelectedTool=function(t){},o.gui.main.updateProgress=function(o){100==o&&t("#tombioOnsDownloadProgressHeader").text("Resource download complete"),t("#tombioOnsDownloadProgressHeader").show(),t("#tombioOnsDownloadProgress").attr("value",o)},o.gui.main.offlineOptions=function(){o.gui.main.dialog("Offline options",'<ons-button  modifier="outline" onclick="tombiovis.f.cacheAll()">Download for offline use</ons-button><p id="tombioOnsDownloadProgressHeader" style="display: none">Downloading resources...</p><ons-progress-bar id="tombioOnsDownloadProgress" value="0"></ons-progress-bar>')},o.gui.main.offerRefresh=function(){var t=document.getElementById("refreshPrompt");t?t.show():ons.createElement("refreshPromptTemplate",{append:!0}).then(function(t){t.show()})},o.gui.main.resizeControlsAndTaxa=function(){},o.gui.main.init=function(){"(max-width: 979px)",e=!window.matchMedia("(max-width: 979px)").matches,t("#tombiod3vis").html(""),t("<div>").attr("id","tombioOnsHiddenVisualisation").hide().appendTo("#tombiod3vis"),t("<div>").attr("id","tombioOnsHiddenControls").hide().appendTo("#tombiod3vis"),o.gui.main.divVis="#tombioOnsHiddenVisualisation",o.gui.main.divInput="#tombioOnsHiddenControls",t("<div>").attr("id","tombioOns").appendTo(t("#tombiod3vis"));var i="";i+='<ons-navigator swipeable id="tombioOnsNavigator" page="tombioOnsSelectTemplate"></ons-navigator>',i+='<template id="tombioOnsSelectTemplate">',i+='<ons-page id="tombioOnsToolSelect">',i+="<ons-toolbar>",i+='<div class="center">'+o.d.kbmetadata.title+"</div>",i+="</ons-toolbar>",i+='<ons-list id="tombioOnsTools"></ons-list>',i+="</ons-page>",i+="</template>",i+='<template id="tombioOnsVisualisationTemplate">',i+='<ons-page id="tombioOnsVisualisation">',i+="<ons-splitter>",i+='<ons-splitter-side id="tombioOnsMenu" side="left" collapse swipeable>',i+='<ons-page id="tombioOnsVisInput">',i+="<ons-toolbar>",i+='<div class="left">',i+='<ons-back-button id="tombioUiSideMenuBackButton"></ons-back-button>',i+="</div>",i+='<div class="right">',i+='<ons-toolbar-button id="tombioUiSideMenuPin" onclick="tombiovis.gui.main.fn.toggleMenuPin()">',i+='<ons-icon  id="tombioUiSideMenuPinIcon" icon=""></ons-icon>',i+="</ons-toolbar-button>",i+="</div>",i+="</ons-toolbar>",i+='<div id="tombioOnsVisInputDiv"></div>',i+="</ons-page>",i+="</ons-splitter-side>",i+='<ons-splitter-content id="content" page="tombioOnsVisDisplayTemplate"></ons-splitter-content>',i+="</ons-splitter>",i+="</ons-page>",i+="</template>",i+='<template id="tombioOnsVisDisplayTemplate">',i+='<ons-page id="tombioOnsVisDisplay">',i+="<ons-toolbar>";var a="";a+='<ons-toolbar-button id="tombioUiContextMenuButton" onclick="tombiovis.gui.main.openContext()">',a+='<ons-icon icon="md-more-vert"></ons-icon>',a+="</ons-toolbar-button>",a+='<ons-toolbar-button onclick="tombiovis.gui.main.popPage()">',a+='<ons-icon icon="md-menu"></ons-icon>',i+='<div class="left">',i+='<ons-toolbar-button id="tombioUiInputToolbarButton" onclick="tombiovis.gui.main.openMenu()">',i+='<ons-icon icon="md-keyboard"></ons-icon>',i+="</ons-toolbar-button>",i+='<div id="tombioOnsToolsLeft" style="display:none">',i+=a+="</ons-toolbar-button>",i+="</div>",i+="</div>",i+='<div id="tombioOnsToolsRight" class="right">',i+=a,i+="</div>",i+="</ons-toolbar>",i+='<div id="tombioOnsVisDisplayDiv"></div>',i+='<div id="tombioOnsOtherInfoDiv"></div>',i+="</ons-page>",i+="</template>",i+='<template id="tombioOnsDialogTemplate">',i+='<ons-page id="tombioOnsDialog">',i+="<ons-toolbar>",i+='<div class="left">',i+="<ons-back-button></ons-back-button>",i+="</div>",i+='<div id="tombioOnsDialogTitle" class="center"></div>',i+="</ons-toolbar>",i+='<div id="tombioOnsDialogContent" style="margin: 1em"></div>',i+="</ons-page>",i+="</template>",i+='<template id="tombioOnsContextTemplate">',i+='<ons-page id="tombioOnsContext">',i+="<ons-toolbar>",i+='<div class="left">',i+="<ons-back-button></ons-back-button>",i+="</div>",i+='<div class="center">Context menu</div>',i+="</ons-toolbar>",i+='<ons-list id="tombioOnsContextContent"></ons-list>',i+="</ons-page>",i+="</template>",i+='<template id="refreshPromptTemplate">',i+='<ons-alert-dialog id="refreshPrompt" modifier="rowfooter">',i+='<div class="alert-dialog-title">Refresh required</div>',i+='<div class="alert-dialog-content">',i+="To complete preparation for using offline, a refresh is required.",i+="</div>",i+='<div class="alert-dialog-footer">',i+='<ons-alert-dialog-button onclick="tombiovis.gui.main.fn.refreshDialogDismissed()">Not now</ons-alert-dialog-button>',i+='<ons-alert-dialog-button onclick="tombiovis.gui.main.fn.refreshDialogDismissed(true)">Refresh</ons-alert-dialog-button>',i+="</div>",i+="</ons-alert-dialog>",i+="</template>",t("#tombioOns").append(t(i)),o.gui.main.fn.refreshDialogDismissed=function(t){document.getElementById("refreshPrompt").hide(),t&&(console.log("Refresh",t),window.location.reload())},o.gui.main.openMenu=function(){document.getElementById("tombioOnsMenu").open()},o.gui.main.openContext=function(){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsContextTemplate").then(function(){!function(){var e=[];for(var i in o.gui.main.contextMenu.items){var n=!0;-1==o.gui.main.contextMenu.visContexts[i].indexOf(o.v.currentTool)&&(n=!1),o.gui.main.contextMenu.guiContexts[i]&&-1==o.gui.main.contextMenu.guiContexts[i].indexOf(o.opts.gui)&&(n=!1),n&&(o.gui.main.contextMenu.items[i].on("click",o.gui.main.popPage),o.gui.main.contextMenu.items[i].on("click",o.gui.main.contextMenu.functions[i]),e.push(o.gui.main.contextMenu.items[i]))}t("#tombioOnsContextContent").html(""),t("#tombioOnsContextContent").append(e)}()})},o.gui.main.popPage=function(){document.querySelector("#tombioOnsNavigator").popPage().then(function(){}).catch(function(){})},document.addEventListener("init",function(e){var i=e.target;"tombioOnsToolSelect"===i.id?o.gui.main.createUIControls(!0):"tombioOnsVisDisplay"===i.id?(t("#tombioOnsVisDisplayDiv").append(t("#tombioOnsHiddenVisualisation")),t("#tombioOnsHiddenVisualisation").show()):"tombioOnsVisInput"===i.id&&(t("#tombioOnsVisInputDiv").append(t("#tombioOnsHiddenControls")),t("#tombioOnsHiddenControls").show(),document.querySelector("#tombioUiSideMenuBackButton").onClick=function(t){document.getElementById("tombioOnsMenu").close()})}),document.addEventListener("destroy",function(o){"tombioOnsVisualisation"===o.target.id&&(t("#tombioOnsHiddenVisualisation").hide(),t("#tombiod3vis").append(t("#tombioOnsHiddenVisualisation")),t("#tombioOnsHiddenControls").hide(),t("#tombiod3vis").append(t("#tombioOnsHiddenControls")))}),document.addEventListener("show",function(t){t.target}),document.addEventListener("hide",function(t){t.target}),ons.orientation.on("change",function(){console.log("Orientation changed"),s(),function(){t("#tombioOnsFullDetailsTab3").length>0&&t("#tombioNbnMapImage").css("height",t("#tombioOnsFullDetailsTab3").height()-10);t("#tombioOnsFullDetailsTab2").length>0&&t(".tombio-galleria-pane").data("galleria").resize({height:t("#tombioOnsFullDetailsTab2").height()})}(),setTimeout(function(){o.f.refreshVisualisation(),n()},1e3)}),o.f.checkInterface("guiOnsenUi",o.templates.gui.main,o.gui.main)},o.gui.main.createUIControls=function(){var e=[];if((o.opts.checkKB||o.opts.devel)&&e.push(t("<ons-list-header>For developers</ons-list-header>")),n='<div class="left"><ons-icon icon="md-wrench" class="list-item__icon"></ons-icon></div>',o.opts.checkKB&&(e.push(t('<ons-list-item value="reloadkb" class="html" data-class="wrench">'+n+"Reload KB</ons-list-item>")),e.push(t('<ons-list-item value="mediaFilesCheck" class="html" data-class="wrench">'+n+"Check media files</ons-list-item>")),o.d.oCharacters.tvk&&e.push(t('<ons-list-item value="tvkCheck" class="html" data-class="wrench">'+n+"Check TVKs</ons-list-item>"))),n='<div class="left"><ons-icon icon="md-lamp" class="list-item__icon"></ons-icon></div>',e.push(t("<ons-list-header>Visualisations</ons-list-header>")),o.v.includedVisualisations.forEach(function(i,s){if(o.opts.toolconfig[i]&&o.opts.toolconfig[i].name)var a=o.opts.toolconfig[i].name;else a=o.js.jsFiles[i].toolName;var l=t("<ons-list-item>").attr("value",i).attr("data-class","vis").text(a);l.append(t(n)),e.push(l)}),(!o.opts.dd||o.opts.dd.indexOf("help")>-1||o.opts.dd.indexOf("kb")>-1||o.opts.dd.indexOf("identikit")>-1||o.opts.dd.indexOf("citation")>-1)&&e.push(t("<ons-list-header>Help &amp; Information</ons-list-header>")),n='<div class="left"><ons-icon icon="md-info" class="list-item__icon"></ons-icon></div>',(!o.opts.dd||o.opts.dd.indexOf("help")>-1)&&e.push(t('<ons-list-item id="optCurrentVisInfo" value="currentVisInfo" class="html" data-class="info">'+n+"Using the...</ons-list-item>")),(!o.opts.dd||o.opts.dd.indexOf("kb")>-1)&&e.push(t('<ons-list-item value="kbInfo" class="html" data-class="info">'+n+"About the Knowledge-base</ons-list-item>")),(!o.opts.dd||o.opts.dd.indexOf("identikit")>-1)&&e.push(t('<ons-list-item value="visInfo" class="html" data-class="info">'+n+"About FSC Identikit</ons-list-item>")),(!o.opts.dd||o.opts.dd.indexOf("citation")>-1)&&e.push(t('<ons-list-item value="tombioCitation" class="html" data-class="info">'+n+"Get citation text</ons-list-item>")),e.push(t('<ons-list-item id="optPdfInfo" style="display: none">'+n+'<a href="'+o.opts.tombiokbpath+'info.pdf">About this resource PDF</a></ons-list-item>')),t.ajax({type:"HEAD",url:o.opts.tombiokbpath+"info.pdf",success:function(o){t("#optPdfInfo").show()}}),(o.opts.pwa||!o.opts.dd||o.opts.dd.indexOf("reload")>-1)&&e.push(t("<ons-list-header>Other</ons-list-header>")),o.opts.pwa){var n='<div class="left"><ons-icon icon="md-download" class="list-item__icon"></ons-icon></div>';e.push(t('<ons-list-item value="offline" class="html" data-class="?">'+n+"Offline options</ons-list-item>"))}if(!o.opts.dd||o.opts.dd.indexOf("reload")>-1){n='<div class="left"><ons-icon icon="md-redo" class="list-item__icon"></ons-icon></div>';e.push(t('<ons-list-item value="reload" class="html" data-class="reload">'+n+"Reload app</ons-list-item>"))}e.forEach(function(t){"ons-list-item"==t.prop("tagName").toLowerCase()&&(i[t.attr("value")]=t.text(),t.on("click",function(){o.v.selectedTool=t.attr("value"),o.f.visChanged(o.v.selectedTool)}))}),t("#tombioOnsTools").append(e)},o.gui.main.visShow=function(i){var n=document.querySelector("#tombioOnsVisualisationTemplate").content.querySelector("#tombioOnsMenu");e?n.removeAttribute("collapse"):n.setAttribute("collapse",""),document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsVisualisationTemplate").then(function(){t("#tombioOnsOtherInfoDiv").html(null);var e;o.v.visualisations[i];"tombioCitation"==i&&t("#tombioOnsOtherInfoDiv").html(((a=t("<div>")).append(t("<h3>").text("Citation for FSC Identikit (core software)")),n="This is the reference you can use for the FSC Identikit - in other words the core software.",n+=" The core version number is updated whenever there is a new major release of the core software.",a.append(t("<p>").html(n)),a.append(t("<b>").html(o.f.getCitation(o.d.softwareMetadata,"Software"))),a.append(t("<h3>").text("Citation for knowledge-base")),n="This is the reference you can use for the knowledge-base currently driving the software.",n+=" The knowledge-base version number is updated whenever there is a new release of the knowledge-base.",a.append(t("<p>").html(n)),a.append(t("<b>").html(o.f.getCitation(o.d.kbmetadata,"Knowledge-base",o.d.softwareMetadata.title))),a));var n,a;"mediaFilesCheck"==i&&t("#tombioOnsOtherInfoDiv").html(o.f.createMediaCheckPage());"tvkCheck"==i&&t("#tombioOnsOtherInfoDiv").html(o.f.createTvkCheckPage());"kbInfo"==i&&o.f.setKbInfo(t("#tombioOnsOtherInfoDiv"));"visInfo"==i&&o.f.setVisInfo(t("#tombioOnsOtherInfoDiv"));"currentVisInfo"==i&&(t("#tombioOnsOtherInfoDiv").html(""),o.f.setSelectedToolInfo(t("#tombioOnsOtherInfoDiv")));i!=o.v.currentTool&&(o.v.currentTool&&(o.v.visualisations[o.v.currentTool]?o.v.visualisations[o.v.currentTool].hide():t("#"+o.v.currentTool).hide()),o.v.visualisations[i]?o.v.visualisations[i].show():t("#"+i).show());o.f.refreshVisualisation(),o.v.currentTool=i,Object.keys(o.v.visualisations).indexOf(i)>-1&&(o.v.lastVis=i,t("#optCurrentVisInfo>div.center").text("Using the "+o.v.visualisations[o.v.lastVis].metadata.title));o.v.includedVisualisations.indexOf(i)>-1?(t("#tombioOnsVisDisplayDiv").show(),t("#tombioOnsOtherInfoDiv").hide()):(t("#tombioOnsVisDisplayDiv").hide(),t("#tombioOnsOtherInfoDiv").show());if(s(),!o.v.initialised&&o.v.visualisations[i]){for(var l={},m=decodeURI(window.location.search.substring(1)).replace(/\+/g," "),d=m.split("&"),u=0;u<d.length;u++){var r=d[u].split("=");l[r[0]]=r[1]}o.v.visualisations[i].urlParams(l),o.v.initialised=!0}console.log(i),Object.keys(o.gui.main.contextMenu.items).forEach(function(t){console.log(o.gui.main.contextMenu.visContexts[t]),-1!=o.gui.main.contextMenu.visContexts[t].indexOf(i)&&(e=!0)}),e?t("ons-toolbar-button#tombioUiContextMenuButton.toolbar-button").show():t("ons-toolbar-button#tombioUiContextMenuButton.toolbar-button").hide()})},o.gui.main.dialog=function(o,e){document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsDialogTemplate").then(function(){t("#tombioOnsDialogTitle").text(o),t("#tombioOnsDialogContent").html(e)})},o.gui.main.createCharacterTooltips=function(t){},o.gui.main.createTaxonToolTips=function(t,o){},o.gui.main.tooltip=function(t){},o.gui.main.showFullDetails=function(e,i,n,s){if(0==t("#tombioOnsFullDetailsTemplate").length){var a="";a+='<template id="tombioOnsFullDetailsTemplate">',a+='<ons-page id="tombioOnsFullDetails">',a+="<ons-toolbar>",a+='<div class="left">',a+="<ons-back-button></ons-back-button>",a+="</div>",a+='<div id="tombioOnsFullDetailsTitle" class="center"></div>',a+="</ons-toolbar>",a+='<ons-tabbar id="tombioOnsFullDetailsTabBar" swipeable position="auto">',a+='<ons-tab page="tombioOnsFullDetailsTab1Template" label="Knowledge" icon="md-grid" active>',a+="</ons-tab>",a+='<ons-tab page="tombioOnsFullDetailsTab2Template" label="Images" icon="md-image">',a+="</ons-tab>",o.d.oCharacters.tvk&&(a+='<ons-tab page="tombioOnsFullDetailsTab3Template" label="NBN Atlas" icon="md-map">',a+="</ons-tab>"),a+='<ons-tab page="tombioOnsFullDetailsTab4Template" label="Info" icon="md-file-text">',a+="</ons-tab>",a+="</ons-tabbar>",a+="</ons-page>",a+="</template>",a+='<template id="tombioOnsFullDetailsTab1Template">',a+='<ons-page id="tombioOnsFullDetailsTab1">',a+='<div id="tombioOnsFullDetailsTab1Content" style="margin: 1em"></div>',a+="</ons-page>",a+="</template>",a+='<template id="tombioOnsFullDetailsTab2Template">',a+='<ons-page id="tombioOnsFullDetailsTab2">',a+='<div id="tombioOnsFullDetailsTab2Content"></div>',a+="</ons-page>",a+="</template>",a+='<template id="tombioOnsFullDetailsTab3Template">',a+='<ons-page id="tombioOnsFullDetailsTab3">',a+='<div id="tombioOnsFullDetailsTab3Content"></div>',a+="</ons-page>",a+="</template>",a+='<template id="tombioOnsFullDetailsTab4Template">',a+='<ons-page id="tombioOnsFullDetailsTab4">',a+='<div id="tombioOnsFullDetailsTab4Content"></div>',a+="</ons-page>",a+="</template>",t("#tombioOns").append(t(a)),document.addEventListener("show",function(e){var i=document.querySelector("#tombioOnsNavigator").topPage.data.taxon,n=document.querySelector("#tombioOnsNavigator").topPage.data.tab;t("#tombioOnsFullDetailsTitle").html("<i>"+i+"</i>"),e.target.matches("#tombioOnsFullDetailsTab1")&&t("#tombioOnsFullDetailsTab1Content").html(o.f.getTaxonCharacterValues(o.d.oTaxa[i])),e.target.matches("#tombioOnsFullDetailsTab2")&&(t("#tombioOnsFullDetailsTab2Content").html(""),t("#tombioOnsFullDetailsTab2Content").attr("data-taxon",i),o.f.addTaxonImagesToContainer({taxon:i,container:t("#tombioOnsFullDetailsTab2Content"),height:t("#tombioOnsFullDetailsTab2").css("height")})),e.target.matches("#tombioOnsFullDetailsTab3")&&(t("#tombioOnsFullDetailsTab3Content").html(""),o.f.addNBNMapToContainer(o.d.oTaxa[i].tvk,t("#tombioOnsFullDetailsTab3Content")),t("#tombioNbnMapImage").css("height",t("#tombioOnsFullDetailsTab3").height()-10)),e.target.matches("#tombioOnsFullDetailsTab4")&&(t("#tombioOnsFullDetailsTab4Content").html(""),function(e,i){var n=t("<div>").css("margin","10px").appendTo(i),s=o.f.getTaxonHtmlFiles(e);if(0==s.length)n.text("No text information files (HTML) are specified in the knowledge-base for this taxon.");else{var l=t("<div>");s.length>1&&(a='<ons-select onchange="tombiovis.gui.main.textFileSelect(event)">',s.forEach(function(t,o){a+='<option value="'+o+'">',a+=t.Caption,a+="</option>"}),a+="</ons-select>",n.html(a)),l.appendTo(n),o.f.addTaxonHtmlToContainer(e,l,0),o.gui.main.textFileSelect=function(t){o.f.addTaxonHtmlToContainer(e,l,t.target.value)}}}(i,t("#tombioOnsFullDetailsTab4Content"))),e.target.matches("#tombioOnsFullDetails")&&n&&document.querySelector("#tombioOnsFullDetailsTabBar").setActiveTab(n)},!1)}document.querySelector("#tombioOnsNavigator").pushPage("tombioOnsFullDetailsTemplate",{data:{taxon:e,tab:i}}).then(function(){})},o.gui.main.fn.toggleMenuPin=function(){(e=!e)?t("#tombioOnsMenu").removeAttr("collapse"):t("#tombioOnsMenu").attr("collapse",""),n(),s(),o.f.refreshVisualisation()},o.gui.main.contextMenu={items:{},functions:{},visContexts:{},guiContexts:{}},o.gui.main.contextMenu.addItem=function(e,i,n,s,a){if(n&&e in o.gui.main.contextMenu.items&&(o.gui.main.contextMenu.items[e].remove(),delete o.gui.main.contextMenu.items[e],delete o.gui.main.contextMenu.functions[e],delete o.gui.main.contextMenu.visContexts[e],delete o.gui.main.contextMenu.guiContexts[e]),!(e in o.gui.main.contextMenu.items)){var l=t('<ons-list-item><div class="left"><ons-icon icon="md-caret-right" class="list-item__icon"></ons-icon></div>'+e+"</ons-list-item>");o.gui.main.contextMenu.items[e]=l,o.gui.main.contextMenu.visContexts[e]=s,o.gui.main.contextMenu.guiContexts[e]=a,o.gui.main.contextMenu.functions[e]=i}},o.gui.main.contextMenu.removeItem=function(t){t in o.gui.main.contextMenu.items&&(delete o.gui.main.contextMenu.items[t],delete o.gui.main.contextMenu.functions[t],delete o.gui.main.contextMenu.visContexts[t],delete o.gui.main.contextMenu.guiContexts[t])},o.gui.main.fn.requestFullscreen=function(){var o=document.documentElement;o.requestFullscreen?o.requestFullscreen():o.mozRequestFullScreen?o.mozRequestFullScreen():o.webkitRequestFullscreen?o.webkitRequestFullscreen():o.msRequestFullscreen&&o.msRequestFullscreen(),t("#tombioUiFullscreenMenuButton").hide(),t("#tombioUiExitFullscreenMenuButton").show()},o.gui.main.fn.exitFullscreen=function(){console.log("exit fullscreen"),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen(),t("#tombioUiFullscreenMenuButton").show(),t("#tombioUiExitFullscreenMenuButton").hide()}}(jQuery,this.tombiovis);