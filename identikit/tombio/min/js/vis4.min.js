!function(e,t){"use strict";var a,i,s,n="vis4",o=t.v.visualisations[n]=Object.create(t.v.visP);function x(e){d(s=e.selected)}function d(a){if(i.html(null),a){var s,o;if(t.opts.toolconfig.vis4&&t.opts.toolconfig.vis4.subTitleChar){var x=t.opts.toolconfig.vis4.subTitleChar;s=t.d.oTaxa[a][x].kbValue}o=s?a+" ("+s+")":a+" ",o+="<span id='vis4TaxonHeaderPadding'>x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x x</span>",e("<div id='vis4TaxonHeader'>").html(o).appendTo(i);var d=document.getElementById("tbVis4Images").checked,l=document.getElementById("tbVis4NbnMap")&&document.getElementById("tbVis4NbnMap").checked,c=document.getElementById("tbVis4Kb").checked,m=document.getElementById("tbVis4Text").checked,p=t.f.getTaxonHtmlFiles(a);if(m=m&&p.length>0,d=d&&t.f.getTaxonImages(a).length>0,l=l&&t.d.oTaxa[a].tvk,d){var h=e('<div style="position: relative">').appendTo(i);m?h.attr("class","vis4ImageWithText"):h.attr("class","vis4ImageNoText");var v=t.d.oTaxa[a].visState[n].indexselectedImg?t.d.oTaxa[a].visState[n].indexselectedImg:0;t.f.addTaxonImagesToContainer({taxon:a,container:h,indexSelected:v,height:m?400:600,fImageSelect:function(e){t.d.oTaxa[a].visState[n].indexselectedImg=e}})}if(l){var r=e('<div style="position: relative">').appendTo(i);m?r.attr("class","vis4ImageWithText"):r.attr("class","vis4ImageNoText"),t.f.addNBNMapToContainer(t.d.oTaxa[a].tvk,r)}if(m){if(p.length>1){var u=e('<div style="margin-bottom: 20px; display: inline">').appendTo(i),g=e("<select id='vis4html'></select>").appendTo(u);p.forEach(function(t,a){var i=e("<option/>").text(t.Caption).attr("value",a);g.append(i)}),g.selectmenu({change:function(e,i){t.f.addTaxonHtmlToContainer(a,T,i.item.value),t.d.oTaxa[a].visState[n].indexselectedText=i.item.value}}).selectmenu("menuWidget")}var T=e('<div class="htmlFile">').appendTo(i),f=t.d.oTaxa[a].visState[n].indexselectedText?t.d.oTaxa[a].visState[n].indexselectedText:0;t.f.addTaxonHtmlToContainer(a,T,f),p.length>1&&g.val(f).selectmenu("refresh")}c&&(i.append(e("<h2>").css("clear","both").text("Knowledge-base values")),i.append(t.f.getTaxonCharacterValues(t.d.oTaxa[a]))),h&&e(window).resize(function(){h.find(".baseimage").trigger("change")})}}o.visName=n,o.initialise=function(){this,this.metadata.title="Full taxon details",this.metadata.year="2018",this.metadata.authors="Burkmar, R",this.metadata.publisher="Field Studies Council",this.metadata.location="Shrewsbury, England",this.metadata.contact="r.burkmar@field-studies-council.org",this.metadata.version="1.8.0",this.helpFiles=[t.opts.tombiopath+"vis4/vis4Help.html",t.opts.tombiopath+"common/full-details.html",t.opts.tombiopath+"common/taxon-select-help.html"],t.gui.main.contextMenu.addItem("Get URL for full details view",function(){!function(){var e=[];e.push("selectedTool="+n),e.push("taxon="+s);var i=document.getElementById("tbVis4Images").checked,o=document.getElementById("tbVis4Kb").checked,x=document.getElementById("tbVis4Text").checked;if(!(i&&o&&x)){var d=[];i&&d.push("image"),x&&d.push("text"),o&&d.push("kb"),e.push("opts="+d.join("-"))}e=a.setParamsFromState(e),t.d.oTaxa[s].visState[n].indexselectedImg&&e.push("imgi="+t.d.oTaxa[s].visState[n].indexselectedImg);t.d.oTaxa[s].visState[n].indexselectedText&&e.push("txti="+t.d.oTaxa[s].visState[n].indexselectedText);t.f.createViewURL(e)}()},!1,[this.visName]);var o=e("<div/>").css("display","block").css("overflow","hidden");function l(a,i,n){if("tbVis4NbnMap"!=a||t.d.oCharacters.tvk){var o=e('<div style="display: inline-block; vertical-align:top; margin-left: 20px">').appendTo(n);o.append(e("<input style='position: relative; top: 0.2em' checked='checked' type='checkbox' name='"+a+"' id='"+a+"'>")),o.append(e("<span>").text(i)),o.change(function(){d(s)})}}e(this.cssSel).append(o),(a=Object.create(t.gui.taxonSelect)).init(t.gui.main.divInput,!1,x),l("tbVis4Images","Images",o),l("tbVis4NbnMap","NBN Map",o),l("tbVis4Kb","Knowledge-base",o),l("tbVis4Text","Show text",o),i=e("<div>").css("margin","10px"),o.append(i),this.taxonSelect=a,this.initialised=!0,t.f.checkInterface(n,t.templates.visTemplate,t.v.visualisations[n])},o.refresh=function(){e("#vis4taxon").selectmenu("menuWidget").css("height",200)},o.urlParams=function(i){if(i.opts){var s=i.opts.split("-");e("#tbVis4Text").prop("checked",s.indexOf("text")>-1),e("#tbVis4Images").prop("checked",s.indexOf("image")>-1),e("#tbVis4Kb").prop("checked",s.indexOf("kb")>-1)}var o=i.taxon?i.taxon.replace(/%20/g," "):"";i.imgi&&(t.d.oTaxa[o].visState[n].indexselectedImg=i.imgi),i.txti&&(t.d.oTaxa[o].visState[n].indexselectedText=i.txti),o&&a.taxonClick(o),a.initStateFromParams(i)},o.show=function(){console.log("Show vis4"),e("#vis4").show(),a.$div.show()},o.hide=function(){e("#vis4").hide(),a.$div.hide()}}(jQuery,this.tombiovis);