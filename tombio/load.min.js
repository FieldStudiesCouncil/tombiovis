(function(n){"use strict";function u(n){var t=n.lastIndexOf("."),r=n.substr(t+1),i=n.substr(0,t);return i.endsWith(".min")?n:i+".min."+r}function f(){t.jquery.loadReady();n.loadScripts(function(){jQuery(document).ready(function(){jQuery("#tombiod3").append(jQuery('<div id="tombiod3vis">'))});e()})}function e(){t.d3.loadReady();n.loadScripts(function(){o()})}function o(){function u(n){if(n[Object.keys(n)[0]]!=""&&n[Object.keys(n)[0]].substr(0,1)!="#"){for(var t in n)n.hasOwnProperty(t)&&(n[t]=n[t]?n[t].trim():"");return n}return null}var t="none";d3.csv(n.opts.tombiokbpath+"taxa.csv?"+t,function(n){return u(n)},function(t){n.taxa=t;console.log("%cLoading - kb taxa loaded","color: blue");i()});d3.csv(n.opts.tombiokbpath+"characters.csv?"+t,function(n){return u(n)},function(t){n.characters=t;n.characters.columns=null;console.log("%cLoading - kb characters loaded","color: blue");i()});d3.csv(n.opts.tombiokbpath+"values.csv?"+t,function(n){return u(n)},function(t){n.values=t;console.log("%cLoading - kb values loaded","color: blue");i()});d3.csv(n.opts.tombiokbpath+"config.csv?"+t,function(n){return u(n)},function(t){n.kbconfig={};n.kbmetadata={};n.kbreleaseHistory=[];var u=[];t.forEach(function(t){var i;t.Type=="config"&&(n.kbconfig[t.Key]=t.Value);n.opts.selectedTool;t.Key=="excludedDefaultTools"&&t.Value.trim()!=""&&(i=t.Value.split(","),i.forEach(function(n){u.push(n.trim())}));t.Key=="otherIncludedTools"&&t.Value.trim()!=""&&(i=t.Value.split(","),i.forEach(function(t){n.includedTools.push(t.trim())}));t.Type=="metadata"&&(n.kbmetadata[t.Key]=t.Value);t.Key=="release"&&n.kbreleaseHistory.push(t)});r.forEach(function(t){u.indexOf(t)==-1&&n.includedTools.push(t)});n.opts.tools&&Array.isArray(n.opts.tools)&&n.opts.tools.length>0&&(n.includedTools=n.opts.tools);console.log("%cLoading - kb metadata loaded","color: blue");i()});d3.csv(n.opts.tombiokbpath+"media.csv?"+t,function(n){return u(n)},function(t){n.media=t;console.log("%cLoading - kb media loaded","color: blue");i()})}function i(){n.taxa&&n.characters&&n.values&&n.kbmetadata&&n.media&&(console.log("%cKB is loaded!","color: blue"),s())}function s(){jQuery.get(n.opts.tombiopath+"import.html?ver="+n.opts.tombiover,function(i){jQuery("#tombiod3vis").html(i);t.tombiovis.loadReady();n.loadScripts(function(){n.hideDownloadSpinner();n.loadComplete()})})}var r,t;window.console||(window.console={log:function(){}});String.prototype.endsWith||(String.prototype.endsWith=function(n,t){return t<this.length?t|=0:t=this.length,this.substr(t-n.length,n.length)===n});String.prototype.startsWith||(String.prototype.startsWith=function(n,t){return this.substr(t||0,n.length)===n});n.opts||(n.opts={});typeof tombiover!="undefined"&&(n.opts.tombiover=tombiover);typeof tombiopath!="undefined"&&(n.opts.tombiopath=tombiopath);typeof tombiokbpath!="undefined"&&(n.opts.tombiokbpath=tombiokbpath);n.opts.tombiover||(n.opts.tombiover="none");n.metadata={title:"Tom.bio Framework for ID visualisations",year:"2016",authors:"Burkmar, R.",publisher:"Field Studies Council",location:"Shrewsbury, England",contact:"richardb@field-studies-council.org",version:"1.6.0"};r=["vis1","vis2","vis5","vis4","vis3"];n.includedTools=[];t=n.jsFiles={add:function(t,i,r){n.jsFiles[t]=Object.create(n.jsFile);n.jsFiles[t].init(t,i,r)},asArray:function(){var t=[];for(var i in n.jsFiles)n.jsFiles.hasOwnProperty(i)&&t.push(n.jsFiles[i]);return t}};n.jsFile={init:function(t,i,r){this.id=t;this.file=n.opts.tombiopath+i;this.dependencies=[];this.css=[];this.load=!1;this.loading=!1;this.loaded=!1;this.toolName=r},addCSS:function(t){this.css.push(n.opts.tombiopath+t)},loadReady:function(){this.load=!0;this.dependencies.forEach(function(n){n.loadReady()})}};n.loadScripts=function(i){var s=t.asArray().filter(function(n){if(n.load&&!n.loading&&!n.loaded){for(var t=0;t<n.dependencies.length;t++)if(!n.dependencies[t].loaded)return!1;return!0}}),o,r,f,e;if(s.length==0){if(o=t.asArray().filter(function(n){if(n.load&&!n.loaded)return!0}),o.length>0){console.log("%cLoading - something's gone wrong, these files were not loaded...","color: red");o.forEach(function(n){console.log(n.id,"load: "+n.load,"loading: "+n.loading,"loaded: "+n.loaded)});return}i();return}r=s[0];r.loading=!0;f=document.createElement("script");e=n.opts.devel?r.file:u(r.file);f.src=e;f.onreadystatechange=f.onload=function(){!f.readyState||/loaded|complete/.test(f.readyState)?(console.log("%cLoading - javascript file loaded: "+e,"color: blue"),r.loaded=!0,r.loading=!1,n.loadScripts(i)):console.log("%cLoading - javascript file load failed: "+e,"color: red")};document.querySelector("head").appendChild(f);r.css.forEach(function(t){var i=document.createElement("link"),r;i.rel="stylesheet";i.type="text/css";r=n.opts.devel?t:u(t);i.href=r;document.querySelector("head").appendChild(i);console.log("%cLoading - CSS file added to head: "+r,"color: blue")})};n.showDownloadSpinner=function(){var n=document.createElement("div"),t,i,r;n.id="downloadspin";t=document.getElementById("tombiod3");t.insertBefore(n,t.firstChild);i={lines:13,length:28,width:14,radius:42,scale:.8,corners:1,color:"#000",opacity:.15,rotate:0,direction:1,speed:1,trail:60,fps:20,zIndex:2e9,className:"spinner",top:"49%",left:"50%",shadow:!1,hwaccel:!1,position:"absolute"};r=new Spinner(i).spin(n)};n.hideDownloadSpinner=function(){var n=document.getElementById("tombiod3"),t=document.getElementById("downloadspin");n.removeChild(t)};t.add("jquery","dependencies/jquery-3.1.1/jquery-3.1.1.min.js");t.add("jqueryui","dependencies/jquery-ui-1.12.1/jquery-ui.min.js");t.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.min.css");t.jqueryui.addCSS("dependencies/jquery-ui-1.12.1/jquery-ui.theme.min.css");t.add("d3","dependencies/d3-4.10.0/d3.v4.min.js");t.add("spinner","dependencies/spin.min.js");t.add("mousewheel","dependencies/jquery.mousewheel.min.js");t.add("touchpunch","dependencies/jquery.ui.touch-punch.min.js");t.add("hammer","dependencies/hammer.min.js");t.add("pqselect","dependencies/pqselect-1.3.2/pqselect.min.js");t.pqselect.addCSS("dependencies/pqselect-1.3.2/pqselect.min.css");t.add("pqgrid","dependencies/pqgrid-2.1.0/pqgrid.min.js");t.pqgrid.addCSS("dependencies/pqgrid-2.1.0/pqgrid.min.css");t.add("tombiovis","tombiovis.js?ver="+n.opts.tombiover);t.tombiovis.addCSS("tombiovis.css");t.add("kbchecks","kbchecks.js?ver="+n.opts.tombiover);t.add("score","score.js?ver="+n.opts.tombiover);t.add("taxonselect","taxonselect.js?ver="+n.opts.tombiover);t.taxonselect.addCSS("taxonselect.css");t.add("visP","visP.js?ver="+n.opts.tombiover);t.add("vis1","vis1/vis1.js?ver="+n.opts.tombiover,"Two-column key");t.vis1.addCSS("vis1/vis1.css");t.add("vis2","vis2/vis2.js?ver="+n.opts.tombiover,"Single-column key");t.vis2.addCSS("vis2/vis2.css");t.add("vis3","vis3/vis3.js?ver="+n.opts.tombiover,"Side by side comparison");t.vis3.addCSS("vis3/vis3.css");t.add("vis4","vis4/vis4.js?ver="+n.opts.tombiover,"Full taxon details");t.vis4.addCSS("vis4/vis4.css");t.add("vis5","vis5/vis5.js?ver="+n.opts.tombiover,"Circle-pack key");t.vis5.addCSS("vis5/vis5.css");t.add("visEarthworm","visEarthworm/visEarthworm.js?ver="+n.opts.tombiover,!0);t.visEarthworm.addCSS("visEarthworm/visEarthworm.css");t.visP.dependencies=[t.mousewheel,t.hammer];t.taxonselect.dependencies=[t.d3,t.jquery,t.jqueryui];t.pqgrid.dependencies=[t.jquery,t.jqueryui];t.pqselect.dependencies=[t.jquery,t.jqueryui];t.tombiovis.dependencies=[t.jquery,t.jqueryui,t.kbchecks,t.pqselect];t.vis1.dependencies=[t.d3,t.jquery,t.jqueryui,t.visP,t.score];t.vis2.dependencies=[t.d3,t.jquery,t.jqueryui,t.visP,t.score];t.vis3.dependencies=[t.d3,t.jquery,t.jqueryui,t.visP,t.taxonselect,t.pqgrid,t.score];t.vis4.dependencies=[t.d3,t.jquery,t.jqueryui,t.visP,t.taxonselect];t.vis5.dependencies=[t.d3,t.jquery,t.jqueryui,t.visP,t.score];t.visEarthworm.dependencies=[t.d3,t.jquery,t.jqueryui];n.startLoad=function(){t.spinner.loadReady();n.loadScripts(function(){n.showDownloadSpinner();f()})};n.opts.loadWait||n.startLoad()})(this.tombiovis?this.tombiovis:this.tombiovis={});